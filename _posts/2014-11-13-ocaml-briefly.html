---
layout: post
title: "OCaml Briefly"
date:   2014-11-13 14:00:00
categories: ocaml
---

<p>
This document gives you a brief tour of <a href="https://ocaml.org/">OCaml</a>. It covers a rather
small selection of features; the selection has been based on what
features I personally think represent OCaml the best.
</p>

<p>
This document does very little to explain use-cases for the selected
features but rather focuses on syntax. For a more in-depth coverage of
all of these features I recommend reading the <a href="http://caml.inria.fr/pub/docs/manual-ocaml/">OCaml Document and User's
Manual</a> and <a href="https://realworldocaml.org/">Real World OCaml</a>.
</p>

<p>
For each feature there is a small explanation of the syntax, some
examples, and links for further reading. As such this document is
ideal for someone who wants to get a taste of the features of OCaml or
who want to learn more about a specific feature.
</p>

<p>
If you have any comments please reach out to me at <a href="mailto:mads379@gmail.com">mads379@gmail.com</a>
or <a href="http://www.twitter.com/mads_hartmann">@mads_hartmann</a> on twitter.
</p>

<p>
If you want to play around with the code I recommend using <a href="http://ocsigen.org/js_of_ocaml/2.5/files/toplevel/index.html">this</a> online
REPL.
</p>

<p>
<b>Note</b>: This is still a work in progress. I haven't yet covered the
following: pattern matching, modules, functors, Abstract
Data Types, and much more.
</p>

<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. Lists, Arrays, and Tuples</a></li>
<li><a href="#sec-2">2. Let-bindings</a></li>
<li><a href="#sec-3">3. Functions</a>
<ul>
<li><a href="#sec-3-1">3.1. Defining functions</a>
<ul>
<li><a href="#sec-3-1-1">3.1.1. Labeled arguments</a></li>
<li><a href="#sec-3-1-2">3.1.2. Optional arguments</a></li>
<li><a href="#sec-3-1-3">3.1.3. Default argument</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-4">4. Records</a></li>
<li><a href="#sec-5">5. Variants</a>
<ul>
<li><a href="#sec-5-1">5.1. Polymorphic Variants</a></li>
<li><a href="#sec-5-2">5.2. Extensible Variants</a></li>
</ul>
</li>
<li><a href="#sec-6">6. Exceptions</a></li>
<li><a href="#sec-7">7. Generalized Algebraic Datatypes</a></li>
</ul>
</div>
</div>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Lists, Arrays, and Tuples</h2>
<div class="outline-text-2" id="text-1">
<p>
A <code>List</code> is constructed using square brackets where the elements are
separated by semi-colons:
</p>
<div class="org-src-container">

<pre class="src src-ocaml"><span class="org-tuareg-font-lock-operator">[</span> 1 <span class="org-tuareg-font-lock-operator">;</span> 2<span class="org-tuareg-font-lock-operator">;</span> 3 <span class="org-tuareg-font-lock-operator">];;</span>
</pre>
</div>

<pre class="example">
- : int list = [1; 2; 3]
</pre>

<p>
An <code>Array</code> is constructed using square brackets with bars where the
elements are separated by semi-colons:
</p>
<div class="org-src-container">

<pre class="src src-ocaml"><span class="org-tuareg-font-lock-operator">[|</span> 1 <span class="org-tuareg-font-lock-operator">;</span> 2<span class="org-tuareg-font-lock-operator">;</span> 3 <span class="org-tuareg-font-lock-operator">|];;</span>
</pre>
</div>

<pre class="example">
- : int array = [|1; 2; 3|]
</pre>

<p>
<code>Tuples</code> are constructed using parens and the elements are separated
using commas:
</p>
<div class="org-src-container">

<pre class="src src-ocaml"><span class="org-tuareg-font-lock-operator">(</span> <span class="org-string">"foo"</span><span class="org-tuareg-font-lock-operator">,</span> <span class="org-string">"bar"</span><span class="org-tuareg-font-lock-operator">,</span> <span class="org-string">"foobar"</span> <span class="org-tuareg-font-lock-operator">)</span>
</pre>
</div>
<pre class="example">
- : string * string * string = ("foo", "bar", "foobar")
</pre>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Let-bindings</h2>
<div class="outline-text-2" id="text-2">
<p>
A let-binding associates an identifier with a value. It is introduced
using the following syntax <code>let &lt;identifier&gt; = &lt;expression&gt; in
&lt;expression&gt;</code>.
</p>
<div class="org-src-container">

<pre class="src src-ocaml"><span class="org-tuareg-font-lock-governing">let</span> <span class="org-variable-name">hi</span> <span class="org-tuareg-font-lock-operator">=</span> <span class="org-string">"hi "</span> <span class="org-tuareg-font-lock-governing">in</span>
<span class="org-tuareg-font-lock-governing">let</span> <span class="org-variable-name">there</span> <span class="org-tuareg-font-lock-operator">=</span> <span class="org-string">"there!"</span> <span class="org-tuareg-font-lock-governing">in</span>
hi <span class="org-tuareg-font-lock-operator">^</span> there<span class="org-tuareg-font-lock-operator">;;</span>
</pre>
</div>
<pre class="example">
hi there!
</pre>

<p>
The <code>^</code> is a function that concatenates two strings. The <code>^</code> function
is used as an infix operator in the example above but it could just as
easily have been invoked in a prefix manner as shown below.
</p>
<div class="org-src-container">

<pre class="src src-ocaml"><span class="org-tuareg-font-lock-operator">(^)</span> <span class="org-string">"Hi "</span> <span class="org-string">"there"</span><span class="org-tuareg-font-lock-operator">;;</span>
</pre>
</div>
<pre class="example">
Hi there
</pre>

<p>
Let-bindings are also used to declare functions. More on that in the
next section.
</p>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> Functions</h2>
<div class="outline-text-2" id="text-3">
<p>
As was shown in the previous section you invoke a function by adding
the arguments after the function name separated by whitespace.
</p>
<div class="org-src-container">

<pre class="src src-ocaml">min 42 10<span class="org-tuareg-font-lock-operator">;;</span>
</pre>
</div>
<pre class="example">
10
</pre>

<p>
It might take some time to get used to separating function arguments
with whitespace rather than commas as you do in other programming
languages. In another language the above example might look like this:
</p>
<div class="org-src-container">

<pre class="src src-ocaml">min<span class="org-tuareg-font-lock-operator">(</span>10<span class="org-tuareg-font-lock-operator">,</span>24<span class="org-tuareg-font-lock-operator">);;</span>
</pre>
</div>
<pre class="example">
- : int * int -&gt; int * int = &lt;fun&gt;
</pre>

<p>
However, in OCaml this will <a href="http://en.wikipedia.org/wiki/Partial_application">partially apply</a> the function <code>min</code> with
one argument, the tuple <code>(10, 24)</code>. Partial application is another
nice feature of OCaml that allows you to supply <code>N</code> arguments to a
function of arity <code>X</code> and get a function of arity <code>X-N</code> in
return. This is possible as all functions in OCaml are <a href="http://en.wikipedia.org/wiki/Currying">curried</a>.
</p>
<div class="org-src-container">

<pre class="src src-ocaml"><span class="org-tuareg-font-lock-governing">let</span> <span class="org-variable-name">at_least_42</span> <span class="org-tuareg-font-lock-operator">=</span> max 42 <span class="org-tuareg-font-lock-governing">in</span>
at_least_42 22<span class="org-tuareg-font-lock-operator">;;</span>
</pre>
</div>
<pre class="example">
42
</pre>
</div>

<div id="outline-container-sec-3-1" class="outline-3">
<h3 id="sec-3-1"><span class="section-number-3">3.1</span> Defining functions</h3>
<div class="outline-text-3" id="text-3-1">
<p>
 A function is defined using the following syntax <code>let &lt;name&gt; &lt;arg1&gt;
&lt;arg2&gt; = &lt;expression&gt; in &lt;expression&gt;</code>, that is, the function name
followed by it's arguments separated by whitespace.
</p>

<p>
The following is a function that takes one argument <code>x</code> (which is
inferred to be an integer) and returns the square value of that
integer.
</p>
<div class="org-src-container">

<pre class="src src-ocaml"><span class="org-tuareg-font-lock-governing">let</span> <span class="org-function-name">square</span><span class="org-variable-name"> x</span> <span class="org-tuareg-font-lock-operator">=</span> x <span class="org-tuareg-font-lock-operator">*</span> x<span class="org-tuareg-font-lock-operator">;;</span>
</pre>
</div>
<pre class="example">
val square : int -&gt; int = &lt;fun&gt;
</pre>

<p>
You can use the <code>fun</code> keyword to introduce a lambda, it has the
following syntax <code>fun &lt;arg1&gt; &lt;arg2&gt; -&gt; &lt;expression&gt;</code>. So the example
above is equivalent to this:
</p>
<div class="org-src-container">

<pre class="src src-ocaml"><span class="org-tuareg-font-lock-governing">let</span> <span class="org-function-name">square</span> <span class="org-tuareg-font-lock-operator">=</span> <span class="org-keyword">fun</span> <span class="org-variable-name">x</span> <span class="org-tuareg-font-lock-operator">-&gt;</span> x <span class="org-tuareg-font-lock-operator">*</span> x<span class="org-tuareg-font-lock-operator">;;</span>
</pre>
</div>
<pre class="example">
val square : int -&gt; int = &lt;fun&gt;
</pre>

<p>
As mentioned earlier some functions can be used as infix operators. A
function can be used as in infix operator if one of the following
names are used <code>! $ % &amp; * + - . / : &lt; = &gt; ? @ ^ | ~</code>. Read more about
infix and prefix functions in <a href="https://realworldocaml.org/v1/en/html/variables-and-functions.html#prefix-and-infix-operators">this section</a> of Real World OCaml.
</p>

<p>
If your function only takes one argument and you want to pattern match
on it you can use the <code>function</code> keyword (please ignore this horribly
inefficient implementation I'm about to show you):
</p>
<div class="org-src-container">

<pre class="src src-ocaml"><span class="org-tuareg-font-lock-governing">let</span> <span class="org-tuareg-font-lock-governing">rec</span> <span class="org-function-name">sum</span> <span class="org-tuareg-font-lock-operator">=</span> <span class="org-keyword">function</span>
  <span class="org-tuareg-font-lock-operator">|</span> x <span class="org-tuareg-font-lock-operator">::</span> xs <span class="org-tuareg-font-lock-operator">-&gt;</span> x <span class="org-tuareg-font-lock-operator">+</span> <span class="org-tuareg-font-lock-operator">(</span>sum xs<span class="org-tuareg-font-lock-operator">)</span>
  <span class="org-tuareg-font-lock-operator">|</span> <span class="org-tuareg-font-lock-operator">[]</span> <span class="org-tuareg-font-lock-operator">-&gt;</span> 0
<span class="org-tuareg-font-lock-governing">in</span> sum <span class="org-tuareg-font-lock-operator">[</span>1<span class="org-tuareg-font-lock-operator">;</span>2<span class="org-tuareg-font-lock-operator">;</span>3<span class="org-tuareg-font-lock-operator">;</span>4<span class="org-tuareg-font-lock-operator">;</span>5<span class="org-tuareg-font-lock-operator">;</span>1<span class="org-tuareg-font-lock-operator">;</span>2<span class="org-tuareg-font-lock-operator">];;</span>
</pre>
</div>
<pre class="example">
18
</pre>

<p>
More on pattern matching <a href="http://mads379.github.io/ocaml/2014/11/13/ocaml-briefly.html#sec-3-1">later</a>. The previous example also shows that
if you want to define a <a href="http://en.wikipedia.org/wiki/Recursion_(computer_science)">recursive function</a> in OCaml you have to use
the <code>rec</code> keyword.
</p>
</div>

<div id="outline-container-sec-3-1-1" class="outline-4">
<h4 id="sec-3-1-1"><span class="section-number-4">3.1.1</span> Labeled arguments</h4>
<div class="outline-text-4" id="text-3-1-1">
<p>
By prefixing an argument with <code>~</code> you can give it a label which
makes the code easier to read and makes the order of the arguments
irrelevant.
</p>
<div class="org-src-container">

<pre class="src src-ocaml"><span class="org-tuareg-font-lock-governing">let</span> <span class="org-function-name">welcome</span><span class="org-variable-name"> </span><span class="org-tuareg-font-lock-operator">~</span><span class="org-variable-name">greeting </span><span class="org-tuareg-font-lock-operator">~</span><span class="org-variable-name">name</span> <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-module">Printf.</span>printf <span class="org-string">"%s %s\n"</span> greeting name <span class="org-tuareg-font-lock-governing">in</span>
welcome <span class="org-constant">~name</span><span class="org-tuareg-font-lock-operator">:</span><span class="org-string">"reader"</span> <span class="org-constant">~greeting</span><span class="org-tuareg-font-lock-operator">:</span><span class="org-string">"Hi"</span>
</pre>
</div>
<pre class="example">
Hi reader
- : unit = ()
</pre>

<p>
Shayne Fletcher has written <a href="http://blog.shaynefletcher.org/2015/03/labeled-and-optional-arguments.html">an excellent blog post</a> that goes into both
labeled and optional arguments (described below) in more detail.
</p>
</div>
</div>

<div id="outline-container-sec-3-1-2" class="outline-4">
<h4 id="sec-3-1-2"><span class="section-number-4">3.1.2</span> Optional arguments</h4>
<div class="outline-text-4" id="text-3-1-2">
<p>
By prefixing an argument with <code>?</code> you can make it optional. The value
of optional arguments are represented using the <a href="https://realworldocaml.org/v1/en/html/a-guided-tour.html#options"><code>Option</code> type</a>.
</p>
<div class="org-src-container">

<pre class="src src-ocaml"><span class="org-tuareg-font-lock-governing">let</span> <span class="org-function-name">welcome</span><span class="org-variable-name"> </span><span class="org-tuareg-font-lock-operator">?</span><span class="org-variable-name">greeting_opt name</span> <span class="org-tuareg-font-lock-operator">=</span>
  <span class="org-tuareg-font-lock-governing">let</span> <span class="org-variable-name">greeting</span> <span class="org-tuareg-font-lock-operator">=</span> <span class="org-keyword">match</span> greeting_opt <span class="org-keyword">with</span>
    <span class="org-tuareg-font-lock-operator">|</span> <span class="org-tuareg-font-lock-constructor">Some</span> greeting <span class="org-tuareg-font-lock-operator">-&gt;</span> greeting
    <span class="org-tuareg-font-lock-operator">|</span> <span class="org-tuareg-font-lock-constructor">None</span> <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-string">"Hi"</span>
  <span class="org-tuareg-font-lock-governing">in</span>
  <span class="org-tuareg-font-lock-module">Printf.</span>printf <span class="org-string">"%s %s\n"</span> greeting name
<span class="org-tuareg-font-lock-governing">in</span>
welcome <span class="org-constant">~greeting_opt</span><span class="org-tuareg-font-lock-operator">:</span><span class="org-string">"Hey"</span> <span class="org-string">"reader"</span> <span class="org-tuareg-font-lock-operator">;</span>
welcome <span class="org-constant">?greeting_opt</span><span class="org-tuareg-font-lock-operator">:</span><span class="org-tuareg-font-lock-constructor">None</span> <span class="org-string">"reader"</span>
</pre>
</div>
<pre class="example">
Hey reader
Hi reader
- : unit = ()
</pre>
</div>
</div>

<div id="outline-container-sec-3-1-3" class="outline-4">
<h4 id="sec-3-1-3"><span class="section-number-4">3.1.3</span> Default argument</h4>
<div class="outline-text-4" id="text-3-1-3">
<p>
For optional arguments you can provide a default value. Thus the
previous example could also have been written as such:
</p>
<div class="org-src-container">

<pre class="src src-ocaml"><span class="org-tuareg-font-lock-governing">let</span> <span class="org-function-name">welcome</span><span class="org-variable-name"> </span><span class="org-tuareg-font-lock-operator">?(</span><span class="org-variable-name">greeting</span><span class="org-tuareg-font-lock-operator">=</span><span class="org-string">"Hi"</span><span class="org-tuareg-font-lock-operator">)</span><span class="org-variable-name"> name</span> <span class="org-tuareg-font-lock-operator">=</span>
  <span class="org-tuareg-font-lock-module">Printf.</span>printf <span class="org-string">"%s %s\n"</span> greeting name
<span class="org-tuareg-font-lock-governing">in</span>
welcome <span class="org-constant">~greeting</span><span class="org-tuareg-font-lock-operator">:</span><span class="org-string">"Hey"</span> <span class="org-string">"reader"</span> <span class="org-tuareg-font-lock-operator">;</span>
welcome <span class="org-string">"reader"</span>
</pre>
</div>
<pre class="example">
Hey reader
Hi reader
- : unit = ()
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> Records</h2>
<div class="outline-text-2" id="text-4">
<p>
Records are used to store a collection of values together as a single
value. The example below defines a record named <code>person</code> with two
components.
</p>
<div class="org-src-container">

<pre class="src src-ocaml"><span class="org-tuareg-font-lock-governing">type</span> <span class="org-type">person</span> <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">{</span>
  name<span class="org-tuareg-font-lock-operator">:</span> string<span class="org-tuareg-font-lock-operator">;</span>
  age<span class="org-tuareg-font-lock-operator">:</span> int<span class="org-tuareg-font-lock-operator">;</span>
<span class="org-tuareg-font-lock-operator">}</span> <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-tuareg-font-lock-governing">let</span> <span class="org-variable-name">p</span> <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">{</span> name <span class="org-tuareg-font-lock-operator">=</span> <span class="org-string">"Mads"</span> <span class="org-tuareg-font-lock-operator">;</span> age <span class="org-tuareg-font-lock-operator">=</span> 25 <span class="org-tuareg-font-lock-operator">}</span> <span class="org-tuareg-font-lock-governing">in</span>
<span class="org-tuareg-font-lock-module">Printf.</span>printf <span class="org-string">"%s is %d years old"</span> p.name p.age
</pre>
</div>
<pre class="example">
Mads is 25 years old- : unit = ()
</pre>

<p>
Records can be parameterized using a polymorphic type.
</p>
<div class="org-src-container">

<pre class="src src-ocaml"><span class="org-tuareg-font-lock-governing">type</span> <span class="org-type">'a ranked</span> <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">{</span>
  item<span class="org-tuareg-font-lock-operator">:</span> 'a<span class="org-tuareg-font-lock-operator">;</span>
  rank<span class="org-tuareg-font-lock-operator">:</span> int<span class="org-tuareg-font-lock-operator">;</span>
<span class="org-tuareg-font-lock-operator">};;</span>
<span class="org-tuareg-font-lock-governing">let</span> <span class="org-variable-name">item</span> <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">{</span> item <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-constructor">Some</span> 42 <span class="org-tuareg-font-lock-operator">;</span> rank <span class="org-tuareg-font-lock-operator">=</span> 1 <span class="org-tuareg-font-lock-operator">}</span>
</pre>
</div>
<pre class="example">
val item : int option ranked = {item = Some 42; rank = 1}
</pre>

<p>
There is a lot more to be said of records. See this <a href="https://realworldocaml.org/v1/en/html/records.html">this section</a> of
Real World OCaml and <a href="http://caml.inria.fr/pub/docs/manual-ocaml/coreexamples.html#sec11">this section</a> of the OCaml Users Guide.
</p>
</div>
</div>

<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> Variants</h2>
<div class="outline-text-2" id="text-5">
<p>
Variants, also known as <a href="http://en.wikipedia.org/wiki/Algebraic_data_type">algebraic data types</a>, are commonly used to
define recursive data structures. Just like records they can be
parameterized using a polymorphic type as shown in the example below
where a variant is used to represent a binary tree.
</p>
<div class="org-src-container">

<pre class="src src-ocaml"><span class="org-tuareg-font-lock-governing">type</span> <span class="org-type">'a tree</span> <span class="org-tuareg-font-lock-operator">=</span>
  <span class="org-tuareg-font-lock-operator">|</span> <span class="org-tuareg-font-lock-constructor">Leaf</span> <span class="org-keyword">of</span> 'a
  <span class="org-tuareg-font-lock-operator">|</span> <span class="org-tuareg-font-lock-constructor">Node</span> <span class="org-keyword">of</span> 'a tree <span class="org-tuareg-font-lock-operator">*</span> 'a <span class="org-tuareg-font-lock-operator">*</span> 'a tree<span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-tuareg-font-lock-constructor">Node</span> <span class="org-tuareg-font-lock-operator">((</span><span class="org-tuareg-font-lock-constructor">Leaf</span> <span class="org-string">"foo"</span><span class="org-tuareg-font-lock-operator">),</span> <span class="org-string">"bar"</span><span class="org-tuareg-font-lock-operator">,</span> <span class="org-tuareg-font-lock-operator">(</span><span class="org-tuareg-font-lock-constructor">Leaf</span> <span class="org-string">"foobar"</span><span class="org-tuareg-font-lock-operator">));;</span>
</pre>
</div>
<pre class="example">
- : string tree = Node (Leaf "foo", "bar", Leaf "foobar")
</pre>

<p>
The type <code>tree</code> has two constructors: <code>Leaf</code> and <code>Node</code>. The example
below shows one way to compute the height of such a tree:
</p>
<div class="org-src-container">

<pre class="src src-ocaml"><span class="org-tuareg-font-lock-governing">let</span> <span class="org-tuareg-font-lock-governing">rec</span> <span class="org-function-name">depth</span> <span class="org-tuareg-font-lock-operator">=</span> <span class="org-keyword">function</span>
  <span class="org-tuareg-font-lock-operator">|</span> <span class="org-tuareg-font-lock-constructor">Leaf</span> _ <span class="org-tuareg-font-lock-operator">-&gt;</span> 1
  <span class="org-tuareg-font-lock-operator">|</span> <span class="org-tuareg-font-lock-constructor">Node</span> <span class="org-tuareg-font-lock-operator">(</span>left<span class="org-tuareg-font-lock-operator">,</span> _ <span class="org-tuareg-font-lock-operator">,</span>right<span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-operator">-&gt;</span> 1 <span class="org-tuareg-font-lock-operator">+</span> max <span class="org-tuareg-font-lock-operator">(</span>depth left<span class="org-tuareg-font-lock-operator">)</span> <span class="org-tuareg-font-lock-operator">(</span>depth right<span class="org-tuareg-font-lock-operator">)</span>
<span class="org-tuareg-font-lock-governing">in</span>
<span class="org-tuareg-font-lock-governing">let</span> <span class="org-variable-name">tree</span> <span class="org-tuareg-font-lock-operator">=</span>
  <span class="org-tuareg-font-lock-constructor">Node</span> <span class="org-tuareg-font-lock-operator">((</span><span class="org-tuareg-font-lock-constructor">Leaf</span> 1<span class="org-tuareg-font-lock-operator">),</span> 2<span class="org-tuareg-font-lock-operator">,</span> <span class="org-tuareg-font-lock-operator">(</span><span class="org-tuareg-font-lock-constructor">Node</span> <span class="org-tuareg-font-lock-operator">((</span><span class="org-tuareg-font-lock-constructor">Leaf</span> 3<span class="org-tuareg-font-lock-operator">),</span> 4<span class="org-tuareg-font-lock-operator">,</span> <span class="org-tuareg-font-lock-operator">(</span><span class="org-tuareg-font-lock-constructor">Node</span> <span class="org-tuareg-font-lock-operator">((</span><span class="org-tuareg-font-lock-constructor">Leaf</span> 5<span class="org-tuareg-font-lock-operator">),</span> 6<span class="org-tuareg-font-lock-operator">,</span> <span class="org-tuareg-font-lock-operator">(</span><span class="org-tuareg-font-lock-constructor">Leaf</span> 6<span class="org-tuareg-font-lock-operator">))))))</span>
<span class="org-tuareg-font-lock-governing">in</span>
depth tree<span class="org-tuareg-font-lock-operator">;;</span>
</pre>
</div>
<pre class="example">
4
</pre>

<p>
The example above uses the <code>function</code> keyword to define a function
that takes a single argument that is pattern matched on.
</p>

<p>
Variants are one of the most useful features of OCaml so it's well
worth spending some more time studying them. See <a href="https://realworldocaml.org/v1/en/html/variants.html">this section</a> of Real
World OCaml for information on use-cases and best-practices.
</p>
</div>

<div id="outline-container-sec-5-1" class="outline-3">
<h3 id="sec-5-1"><span class="section-number-3">5.1</span> Polymorphic Variants</h3>
<div class="outline-text-3" id="text-5-1">
<p>
OCaml also has another type of variants that they call polymorphic
variants. When using polymorphic variants you do not need to define
the constructors prior to using them - you can think of them as an
ad-hoc version of the regular variants.
</p>
<div class="org-src-container">

<pre class="src src-ocaml"><span class="org-tuareg-font-lock-governing">let</span> <span class="org-function-name">length_of_title</span><span class="org-variable-name"> book_title</span> <span class="org-tuareg-font-lock-operator">=</span>
  <span class="org-keyword">match</span> <span class="org-tuareg-font-lock-module">String.</span>length book_title <span class="org-keyword">with</span>
  <span class="org-tuareg-font-lock-operator">|</span> length <span class="org-keyword">when</span> length <span class="org-tuareg-font-lock-operator">&lt;=</span> 5  <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-tuareg-font-lock-constructor">`Short</span>
  <span class="org-tuareg-font-lock-operator">|</span> length <span class="org-keyword">when</span> length <span class="org-tuareg-font-lock-operator">&lt;=</span> 10 <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-tuareg-font-lock-constructor">`Medium</span>
  <span class="org-tuareg-font-lock-operator">|</span> _  <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-tuareg-font-lock-constructor">`Long</span>
<span class="org-tuareg-font-lock-governing">in</span>
length_of_title <span class="org-string">"The Hitchhiker's Guide to the Galaxy"</span>
</pre>
</div>
<pre class="example">
- : [&gt; `Long | `Medium | `Short ] = `Long
</pre>

<p>
Once again this feature is thoroughly covered in <a href="https://realworldocaml.org/v1/en/html/variants.html#polymorphic-variants">this section</a> of Real
World OCaml.
</p>
</div>
</div>

<div id="outline-container-sec-5-2" class="outline-3">
<h3 id="sec-5-2"><span class="section-number-3">5.2</span> Extensible Variants</h3>
<div class="outline-text-3" id="text-5-2">
<p>
As the name suggests extensible variants are variants that can be
extended with new constructors.
</p>

<p>
This is a new feature that was introduced in OCaml 4.02 and as such I
haven't yet used these in my own code so I will stick to the examples
shown in the OCaml Users Manual.
</p>

<div class="org-src-container">

<pre class="src src-ocaml"><span class="org-tuareg-font-lock-governing">type</span> <span class="org-type">attr</span> <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator">..</span> <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-tuareg-font-lock-governing">type</span> <span class="org-type">attr</span> <span class="org-tuareg-font-lock-operator">+=</span> <span class="org-tuareg-font-lock-constructor">Str</span> <span class="org-keyword">of</span> string <span class="org-tuareg-font-lock-operator">;;</span>
<span class="org-tuareg-font-lock-governing">type</span> <span class="org-type">attr</span> <span class="org-tuareg-font-lock-operator">+=</span>
  <span class="org-tuareg-font-lock-operator">|</span> <span class="org-tuareg-font-lock-constructor">Int</span> <span class="org-keyword">of</span> int
  <span class="org-tuareg-font-lock-operator">|</span> <span class="org-tuareg-font-lock-constructor">Float</span> <span class="org-keyword">of</span> float <span class="org-tuareg-font-lock-operator">;;</span>
</pre>
</div>
<pre class="example">
type attr += Int of int | Float of float
</pre>

<p>
For more information read this <a href="http://caml.inria.fr/pub/docs/manual-ocaml/extn.html#sec246">section</a> of the OCaml Users Manual. This
features was released after Real World Ocaml and as such it isn't
covered in the book unfortunately. I look forward to then next
revision.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6"><span class="section-number-2">6</span> Exceptions</h2>
<div class="outline-text-2" id="text-6">
<p>
OCaml gives you the posibility of using exceptions for signaling and
handling exceptional conditions in your programs.
</p>

<p>
Exceptions are not checked, meaning that the OCaml compiler does not
enforce that you catch exceptions.
</p>

<p>
You can define your own exceptions in a way similar to variants.
</p>
<div class="org-src-container">

<pre class="src src-ocaml"><span class="org-keyword">exception</span> <span class="org-variable-name">BadRequest</span> <span class="org-keyword">of</span> int <span class="org-tuareg-font-lock-operator">*</span> string
</pre>
</div>
<p>
You signal an exception using the <code>raise</code> keyword.
</p>
<div class="org-src-container">

<pre class="src src-ocaml"><span class="org-builtin">raise</span> <span class="org-tuareg-font-lock-operator">(</span><span class="org-tuareg-font-lock-constructor">BadRequest</span> <span class="org-tuareg-font-lock-operator">(</span>500<span class="org-tuareg-font-lock-operator">,</span> <span class="org-string">"Oh noes, the service broke"</span><span class="org-tuareg-font-lock-operator">))</span>
</pre>
</div>
<p>
You catch exceptions using the following syntax
</p>
<div class="org-src-container">

<pre class="src src-ocaml"><span class="org-keyword">try</span> int_of_string <span class="org-string">"foo"</span> <span class="org-keyword">with</span>
<span class="org-tuareg-font-lock-operator">|</span> <span class="org-tuareg-font-lock-constructor">Failure</span> msg <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-tuareg-font-lock-operator">-</span>1
</pre>
</div>
<pre class="example">
-1
</pre>

<p>
Since OCaml 4.02 you can <a href="http://caml.inria.fr/pub/docs/manual-ocaml/extn.html#sec245">catch exceptions in pattern matches</a>.
</p>
<div class="org-src-container">

<pre class="src src-ocaml"><span class="org-keyword">match</span> int_of_string <span class="org-string">"foo"</span> <span class="org-keyword">with</span>
<span class="org-tuareg-font-lock-operator">|</span> n <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-tuareg-font-lock-module">Printf.</span>printf <span class="org-string">"Got an integer %d"</span> n
<span class="org-tuareg-font-lock-operator">|</span> <span class="org-keyword">exception</span> <span class="org-variable-name">Failure</span> msg <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-tuareg-font-lock-module">Printf.</span>printf <span class="org-string">"Caught exception with message %s"</span> msg
</pre>
</div>
<pre class="example">
Caught exception with message int_of_string- : unit = ()
</pre>

<p>
As always, for more information read the <a href="http://caml.inria.fr/pub/docs/manual-ocaml/coreexamples.html#sec13">section</a> in the OCaml Users
Manual.
</p>
</div>
</div>

<div id="outline-container-sec-7" class="outline-2">
<h2 id="sec-7"><span class="section-number-2">7</span> Generalized Algebraic Datatypes</h2>
<div class="outline-text-2" id="text-7">
<p>
Generalized Algebraic Datatypes (GADTs) are an extension of the normal
variants (algebraic datatypes). They can be used to allow the OCaml
compiler to perform more sophisticated type checking or to control the
memory representation of your data. I wrote a <a href="http://mads-hartmann.com/ocaml/2015/01/05/gadt-ocaml.html">blog post</a> about the
former and Janestreet has written a great <a href="https://blogs.janestreet.com/why-gadts-matter-for-performance/?utm_source=rss&utm_medium=rss&utm_campaign=why-gadts-matter-for-performance">blog post</a> on the latter.
</p>

<p>
The following is an example from my <a href="http://mads-hartmann.com/ocaml/2015/01/05/gadt-ocaml.html">blog post</a>. I include it here as an
example of the syntax you use to define GADTs.
</p>

<div class="org-src-container">

<pre class="src src-ocaml"><span class="org-tuareg-font-lock-governing">type</span> <span class="org-type">_</span> value' <span class="org-tuareg-font-lock-operator">=</span>
  <span class="org-tuareg-font-lock-operator">|</span> <span class="org-tuareg-font-lock-constructor">GBool</span> <span class="org-tuareg-font-lock-operator">:</span> bool <span class="org-tuareg-font-lock-operator">-&gt;</span> bool value'
  <span class="org-tuareg-font-lock-operator">|</span> <span class="org-tuareg-font-lock-constructor">GInt</span> <span class="org-tuareg-font-lock-operator">:</span> int <span class="org-tuareg-font-lock-operator">-&gt;</span> int value'

<span class="org-tuareg-font-lock-governing">type</span> <span class="org-type">_</span> expr' <span class="org-tuareg-font-lock-operator">=</span>
  <span class="org-tuareg-font-lock-operator">|</span> <span class="org-tuareg-font-lock-constructor">GValue</span> <span class="org-tuareg-font-lock-operator">:</span> 'a value' <span class="org-tuareg-font-lock-operator">-&gt;</span> 'a expr'
  <span class="org-tuareg-font-lock-operator">|</span> <span class="org-tuareg-font-lock-constructor">GIf</span> <span class="org-tuareg-font-lock-operator">:</span> bool expr' <span class="org-tuareg-font-lock-operator">*</span> 'a expr' <span class="org-tuareg-font-lock-operator">*</span> 'a expr' <span class="org-tuareg-font-lock-operator">-&gt;</span> 'a expr'
  <span class="org-tuareg-font-lock-operator">|</span> <span class="org-tuareg-font-lock-constructor">GEq</span> <span class="org-tuareg-font-lock-operator">:</span> 'a expr' <span class="org-tuareg-font-lock-operator">*</span> 'a expr' <span class="org-tuareg-font-lock-operator">-&gt;</span> bool expr'
  <span class="org-tuareg-font-lock-operator">|</span> <span class="org-tuareg-font-lock-constructor">GLt</span> <span class="org-tuareg-font-lock-operator">:</span> int expr' <span class="org-tuareg-font-lock-operator">*</span> int expr' <span class="org-tuareg-font-lock-operator">-&gt;</span> bool expr'
</pre>
</div>

<p>
GADTs were introduced in OCaml 4.00. The following <a href="http://caml.inria.fr/pub/docs/manual-ocaml/extn.html#sec238">section</a> in the
OCaml Users Manual describe the syntax and contains a few examples.
</p>
</div>
</div>
